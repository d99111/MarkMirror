<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MarkMirror Tests</title>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            max-width: 800px;
            margin: 0 auto;
            padding: 2rem;
            background-color: #f8f9fa;
        }
        
        .container {
            background: white;
            padding: 2rem;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        
        h1 {
            color: #333;
            margin-bottom: 1rem;
        }
        
        .test-controls {
            margin-bottom: 2rem;
        }
        
        button {
            background: #007bff;
            color: white;
            border: none;
            padding: 0.75rem 1.5rem;
            border-radius: 4px;
            cursor: pointer;
            font-size: 1rem;
            margin-right: 1rem;
        }
        
        button:hover {
            background: #0056b3;
        }
        
        button:disabled {
            background: #6c757d;
            cursor: not-allowed;
        }
        
        .console-output {
            background: #1e1e1e;
            color: #d4d4d4;
            padding: 1rem;
            border-radius: 4px;
            font-family: 'Courier New', monospace;
            font-size: 0.9rem;
            line-height: 1.4;
            max-height: 400px;
            overflow-y: auto;
            white-space: pre-wrap;
            margin-top: 1rem;
        }
        
        .test-demo {
            margin-top: 2rem;
            padding: 1rem;
            border: 1px solid #dee2e6;
            border-radius: 4px;
        }
            
        .demo-input {
            width: calc(100% - 2rem);
            height: 150px;
            padding: 0.75rem;
            border: 1px solid #ced4da;
            border-radius: 4px;
            font-family: 'Courier New', monospace;
            font-size: 0.9rem;
            resize: vertical;
        }
        
        .demo-output {
            margin-top: 1rem;
            padding: 1rem;
            border: 1px solid #dee2e6;
            border-radius: 4px;
            background: #f8f9fa;
            min-height: 100px;
        }
        
        .status {
            padding: 0.5rem 1rem;
            border-radius: 4px;
            margin-top: 1rem;
            font-weight: 500;
        }
        
        .status.success {
            background: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }
        
        .status.error {
            background: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>üß™ MarkMirror Tests</h1>
        
        <div class="test-controls">
            <button id="run-tests">–ó–∞–ø—É—Å—Ç–∏—Ç—å —Ç–µ—Å—Ç—ã –ø–∞—Ä—Å–µ—Ä–∞</button>
            <button id="run-demo">–î–µ–º–æ –ø–∞—Ä—Å–µ—Ä–∞</button>
            <button id="clear-console">–û—á–∏—Å—Ç–∏—Ç—å –∫–æ–Ω—Å–æ–ª—å</button>
        </div>
        
        <div id="status" class="status" style="display: none;"></div>
        
        <div id="console-output" class="console-output"></div>
        
        <div class="test-demo" id="demo-section" style="display: none;">
            <h3>–î–µ–º–æ –ø–∞—Ä—Å–µ—Ä–∞ Markdown</h3>
            <p>–í–≤–µ–¥–∏—Ç–µ Markdown —Ç–µ–∫—Å—Ç –¥–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è:</p>
            <textarea id="demo-input" class="demo-input" placeholder="# –ó–∞–≥–æ–ª–æ–≤–æ–∫

**–ñ–∏—Ä–Ω—ã–π —Ç–µ–∫—Å—Ç** –∏ *–∫—É—Ä—Å–∏–≤–Ω—ã–π —Ç–µ–∫—Å—Ç*

- –≠–ª–µ–º–µ–Ω—Ç —Å–ø–∏—Å–∫–∞
- –î—Ä—É–≥–æ–π —ç–ª–µ–º–µ–Ω—Ç

```javascript
console.log('Hello, World!');
```

| –ö–æ–ª–æ–Ω–∫–∞ 1 | –ö–æ–ª–æ–Ω–∫–∞ 2 |
|-----------|-----------|
| –Ø—á–µ–π–∫–∞ 1  | –Ø—á–µ–π–∫–∞ 2  |"></textarea>
            
            <div id="demo-output" class="demo-output"></div>
        </div>
    </div>

    <script type="module">
        import { MarkdownParser } from '../src/utils/markdownParser.js';
        
        // Console output capture
        const consoleOutput = document.getElementById('console-output');
        const originalLog = console.log;
        const originalError = console.error;
        const originalWarn = console.warn;
        
        function appendToConsole(message, type = 'log') {
            const timestamp = new Date().toLocaleTimeString();
            const prefix = type === 'error' ? '‚ùå' : type === 'warn' ? '‚ö†Ô∏è' : '‚ÑπÔ∏è';
            consoleOutput.textContent += `[${timestamp}] ${prefix} ${message}\n`;
            consoleOutput.scrollTop = consoleOutput.scrollHeight;
        }
        
        console.log = (...args) => {
            originalLog(...args);
            appendToConsole(args.join(' '), 'log');
        };
        
        console.error = (...args) => {
            originalError(...args);
            appendToConsole(args.join(' '), 'error');
        };
        
        console.warn = (...args) => {
            originalWarn(...args);
            appendToConsole(args.join(' '), 'warn');
        };
        
        // Test controls
        document.getElementById('run-tests').addEventListener('click', async () => {
            const button = document.getElementById('run-tests');
            const status = document.getElementById('status');
            
            button.disabled = true;
            button.textContent = '–í—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è...';
            status.style.display = 'none';
            
            try {
                // Import and run tests
                const { runner } = await import('./markdownParser.test.js');
                const success = await runner.run();
                
                status.className = success ? 'status success' : 'status error';
                status.textContent = success ? '‚úÖ –í—Å–µ —Ç–µ—Å—Ç—ã –ø—Ä–æ—à–ª–∏ —É—Å–ø–µ—à–Ω–æ!' : '‚ùå –ù–µ–∫–æ—Ç–æ—Ä—ã–µ —Ç–µ—Å—Ç—ã –Ω–µ –ø—Ä–æ—à–ª–∏';
                status.style.display = 'block';
                
            } catch (error) {
                console.error('–û—à–∏–±–∫–∞ –ø—Ä–∏ –∑–∞–ø—É—Å–∫–µ —Ç–µ—Å—Ç–æ–≤:', error);
                status.className = 'status error';
                status.textContent = '‚ùå –û—à–∏–±–∫–∞ –ø—Ä–∏ –∑–∞–ø—É—Å–∫–µ —Ç–µ—Å—Ç–æ–≤';
                status.style.display = 'block';
            } finally {
                button.disabled = false;
                button.textContent = '–ó–∞–ø—É—Å—Ç–∏—Ç—å —Ç–µ—Å—Ç—ã –ø–∞—Ä—Å–µ—Ä–∞';
            }
        });
        
        document.getElementById('run-demo').addEventListener('click', () => {
            const demoSection = document.getElementById('demo-section');
            demoSection.style.display = demoSection.style.display === 'none' ? 'block' : 'none';
            
            if (demoSection.style.display === 'block') {
                setupDemo();
            }
        });
        
        document.getElementById('clear-console').addEventListener('click', () => {
            consoleOutput.textContent = '';
        });
        
        function setupDemo() {
            console.log('Setting up demo...');

            try {
                const parser = new MarkdownParser();
                const input = document.getElementById('demo-input');
                const output = document.getElementById('demo-output');

                if (!input || !output) {
                    console.error('Demo elements not found!');
                    return;
                }

                console.log('Demo elements found, setting up parser...');

                function updateOutput() {
                    try {
                        const inputValue = input.value || input.placeholder;
                        console.log('Parsing input:', inputValue.substring(0, 50) + '...');

                        const html = parser.parse(inputValue);
                        console.log('Parsed HTML:', html.substring(0, 100) + '...');

                        output.innerHTML = html;

                        // Add some styling to the output
                        output.style.minHeight = '200px';
                        output.style.maxHeight = '400px';
                        output.style.overflowY = 'auto';

                    } catch (error) {
                        console.error('Parsing error:', error);
                        output.innerHTML = `<div style="color: red; padding: 1rem;">
                            <strong>–û—à–∏–±–∫–∞ –ø–∞—Ä—Å–∏–Ω–≥–∞:</strong><br>
                            ${error.message}<br><br>
                            <small>–ü—Ä–æ–≤–µ—Ä—å—Ç–µ –∫–æ–Ω—Å–æ–ª—å –¥–ª—è –ø–æ–¥—Ä–æ–±–Ω–æ—Å—Ç–µ–π</small>
                        </div>`;
                    }
                }

                input.addEventListener('input', updateOutput);

                // Set initial content if empty
                if (!input.value.trim()) {
                    input.value = input.placeholder;
                }

                updateOutput(); // Initial render
                console.log('Demo setup completed');

            } catch (error) {
                console.error('Failed to setup demo:', error);
            }
        }
        
        // Initial message
        console.log('üöÄ MarkMirror Test Suite –≥–æ—Ç–æ–≤ –∫ —Ä–∞–±–æ—Ç–µ');
        console.log('–ù–∞–∂–º–∏—Ç–µ "–ó–∞–ø—É—Å—Ç–∏—Ç—å —Ç–µ—Å—Ç—ã –ø–∞—Ä—Å–µ—Ä–∞" –¥–ª—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è unit-—Ç–µ—Å—Ç–æ–≤');
    </script>
</body>
</html>
