<!DOCTYPE html>
<html lang="ru">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no, viewport-fit=cover" />
    <title>MarkMirror Mobile - Markdown Editor</title>

    <!-- PWA Meta Tags -->
    <meta name="description" content="–ú–æ—â–Ω—ã–π Markdown-—Ä–µ–¥–∞–∫—Ç–æ—Ä —Å –¥–≤—É—Ö–ø–∞–Ω–µ–ª—å–Ω—ã–º –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–æ–º –∏ –∂–∏–≤—ã–º –ø—Ä–µ–≤—å—é" />
    <meta name="keywords" content="markdown, editor, preview, pwa, mobile, text, writing" />
    <meta name="author" content="MarkMirror Team" />

    <!-- PWA Manifest -->
    <link rel="manifest" href="/manifest.json" />

    <!-- Theme Colors -->
    <meta name="theme-color" content="#007bff" />
    <meta name="msapplication-TileColor" content="#007bff" />
    <meta name="msapplication-navbutton-color" content="#007bff" />
    <meta name="apple-mobile-web-app-status-bar-style" content="default" />

    <!-- Apple Touch Icons -->
    <link rel="apple-touch-icon" sizes="72x72" href="src/img/icon-72x72.png" />
    <link rel="apple-touch-icon" sizes="96x96" href="src/img/icon-96x96.png" />
    <link rel="apple-touch-icon" sizes="128x128" href="src/img/icon-128x128.png" />
    <link rel="apple-touch-icon" sizes="144x144" href="src/img/icon-144x144.png" />
    <link rel="apple-touch-icon" sizes="152x152" href="src/img/icon-152x152.png" />
    <link rel="apple-touch-icon" sizes="192x192" href="src/img/icon-192x192.png" />
    <link rel="apple-touch-icon" sizes="384x384" href="src/img/icon-384x384.png" />
    <link rel="apple-touch-icon" sizes="512x512" href="src/img/icon-512x512.png" />

    <!-- Standard Favicons -->
    <link rel="icon" type="image/png" sizes="32x32" href="src/img/icon-32x32.png" />
    <link rel="icon" type="image/png" sizes="16x16" href="src/img/icon-16x16.png" />
    <link rel="shortcut icon" href="src/img/favicon-old.ico" />

    <!-- Apple Web App -->
    <meta name="apple-mobile-web-app-capable" content="yes" />
    <meta name="apple-mobile-web-app-title" content="MarkMirror" />

    <!-- Microsoft Tiles -->
    <meta name="msapplication-TileImage" content="src/img/icon-144x144.png" />
    <meta name="msapplication-config" content="browserconfig.xml" />

    <!-- External Libraries -->
    <!-- CodeMirror 6 - Using importmap for better module resolution -->
    <script type="importmap">
      {
        "imports": {
          "@codemirror/state": "https://cdn.skypack.dev/@codemirror/state",
          "@codemirror/view": "https://cdn.skypack.dev/@codemirror/view",
          "@codemirror/basic-setup": "https://cdn.skypack.dev/@codemirror/basic-setup",
          "@codemirror/lang-markdown": "https://cdn.skypack.dev/@codemirror/lang-markdown",
          "@codemirror/theme-one-dark": "https://cdn.skypack.dev/@codemirror/theme-one-dark",
          "@codemirror/autocomplete": "https://cdn.skypack.dev/@codemirror/autocomplete"
        }
      }
    </script>

    <!-- Highlight.js for code syntax highlighting -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/styles/default.min.css" />
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/styles/github-dark.min.css" media="(prefers-color-scheme: dark)" />
    <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/highlight.min.js"></script>

    <!-- DOMPurify for HTML sanitization -->
    <script src="https://cdn.jsdelivr.net/npm/dompurify@3.0.5/dist/purify.min.js"></script>

    <!-- Marked.js for comparison (optional) -->
    <script src="https://cdn.jsdelivr.net/npm/marked@9.1.6/marked.min.js"></script>

    <!-- Custom Styles -->
    <link rel="stylesheet" href="src/style/index.css" />

    <!-- Editor Actions Module -->
    <link rel="stylesheet" href="src/style/editor-actions.css" />
  </head>
  <body>
    <!-- Main Container -->
    <div id="app" class="app">
      <!-- Header with controls -->
      <header class="header">
        <div class="header-left">
          <h1 class="app-title">MarkMirror Mobile</h1>
          <div class="file-controls">
            <input type="file" id="import-file" accept=".md,.txt" style="display: none" />
            <button id="import-btn" class="btn btn-secondary" title="–ò–º–ø–æ—Ä—Ç .md —Ñ–∞–π–ª–∞">üìÅ –ò–º–ø–æ—Ä—Ç</button>
            <button id="export-md-btn" class="btn btn-secondary" title="–≠–∫—Å–ø–æ—Ä—Ç –≤ .md">üíæ .md</button>
            <button id="export-html-btn" class="btn btn-secondary" title="–≠–∫—Å–ø–æ—Ä—Ç –≤ .html">üåê .html</button>
            <button id="clear-btn" class="btn btn-danger" title="–û—á–∏—Å—Ç–∏—Ç—å —Ä–µ–¥–∞–∫—Ç–æ—Ä">üóëÔ∏è –û—á–∏—Å—Ç–∏—Ç—å</button>
          </div>
        </div>

        <div class="header-right">
          <div class="controls">
            <!-- Theme toggle -->
            <button id="theme-toggle" class="btn btn-icon" title="–ü–µ—Ä–µ–∫–ª—é—á–∏—Ç—å —Ç–µ–º—É">üåô</button>

            <!-- Settings toggle -->
            <button id="settings-toggle" class="btn btn-icon" title="–ù–∞—Å—Ç—Ä–æ–π–∫–∏">‚öôÔ∏è</button>

            <!-- Analytics toggle -->
            <button id="analytics-toggle" class="btn btn-icon" title="–ê–Ω–∞–ª–∏—Ç–∏–∫–∞">üìä</button>

            <!-- Search toggle -->
            <button id="search-toggle" class="btn btn-icon" title="–ü–æ–∏—Å–∫ –∏ –∑–∞–º–µ–Ω–∞ (Ctrl+F)">üîç</button>

            <!-- Help toggle -->
            <button id="help-toggle" class="btn btn-icon" title="–°–ø—Ä–∞–≤–∫–∞">‚ùì</button>
          </div>
        </div>
      </header>

      <!-- Settings Panel -->
      <div id="settings-panel" class="settings-panel hidden">
        <div class="settings-content">
          <h3>–ù–∞—Å—Ç—Ä–æ–π–∫–∏</h3>

          <div class="setting-group">
            <label>
              <input type="checkbox" id="auto-complete-toggle" checked />
              –ê–≤—Ç–æ–¥–æ–ø–æ–ª–Ω–µ–Ω–∏–µ Markdown
            </label>
          </div>

          <div class="setting-group">
            <label>
              <input type="checkbox" id="sync-scroll-toggle" />
              –°–∏–Ω—Ö—Ä–æ–Ω–Ω–∞—è –ø—Ä–æ–∫—Ä—É—Ç–∫–∞
            </label>
          </div>

          <div class="setting-group">
            <label>
              <input type="checkbox" id="use-external-parser-toggle" />
              –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –≤–Ω–µ—à–Ω–∏–π –ø–∞—Ä—Å–µ—Ä (Marked.js)
            </label>
          </div>

          <div class="setting-group">
            <label>
              <input type="checkbox" id="embed-styles-toggle" checked />
              –í—Å—Ç—Ä–∞–∏–≤–∞—Ç—å —Å—Ç–∏–ª–∏ –ø—Ä–∏ —ç–∫—Å–ø–æ—Ä—Ç–µ HTML
            </label>
          </div>

          <div class="setting-group">
            <label>
              <input type="checkbox" id="markdown-highlight-toggle" checked />
              –ü–æ–¥—Å–≤–µ—Ç–∫–∞ Markdown –≤ Plain Text
            </label>
          </div>

          <div class="setting-group">
            <label>
              <input type="checkbox" name="actionBarVisible" checked />
              –ü–æ–∫–∞–∑—ã–≤–∞—Ç—å –ø–∞–Ω–µ–ª—å –¥–µ–π—Å—Ç–≤–∏–π
            </label>
          </div>

          <div class="setting-group">
            <label for="highlight-color">–¶–≤–µ—Ç –ø–æ–¥—Å–≤–µ—Ç–∫–∏ –ø–æ–∏—Å–∫–∞:</label>
            <input type="color" name="highlightColor" value="#ffeb3b" />
          </div>

          <div class="setting-group">
            <label for="preview-zoom">–ú–∞—Å—à—Ç–∞–± –ø—Ä–µ–≤—å—é:</label>
            <input type="range" id="preview-zoom" min="50" max="200" value="100" step="25" />
            <span id="zoom-value">100%</span>
          </div>

          <div class="setting-group">
            <button id="reset-settings" class="btn btn-danger" title="–°–±—Ä–æ—Å–∏—Ç—å –≤—Å–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –∫ –∑–Ω–∞—á–µ–Ω–∏—è–º –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é">
              üîÑ –°–±—Ä–æ—Å–∏—Ç—å –Ω–∞—Å—Ç—Ä–æ–π–∫–∏
            </button>
          </div>
        </div>
      </div>

      <!-- Search and Replace Panel -->
      <div id="search-panel" class="search-panel hidden">
        <div class="search-content">
          <div class="search-header">
            <h3>–ü–æ–∏—Å–∫ –∏ –∑–∞–º–µ–Ω–∞</h3>
            <button id="search-close" class="btn btn-icon" title="–ó–∞–∫—Ä—ã—Ç—å">‚úï</button>
          </div>

          <div class="search-form">
            <!-- Search input -->
            <div class="search-group">
              <label for="search-input">–ù–∞–π—Ç–∏:</label>
              <div class="search-input-container">
                <input type="text" id="search-input" class="search-field" placeholder="–í–≤–µ–¥–∏—Ç–µ —Ç–µ–∫—Å—Ç –¥–ª—è –ø–æ–∏—Å–∫–∞..." />
                <div class="search-options">
                  <button id="search-regex-toggle" class="btn btn-option" title="–†–µ–≥—É–ª—è—Ä–Ω—ã–µ –≤—ã—Ä–∞–∂–µ–Ω–∏—è" data-active="false">.*</button>
                  <button id="search-case-toggle" class="btn btn-option" title="–£—á–∏—Ç—ã–≤–∞—Ç—å —Ä–µ–≥–∏—Å—Ç—Ä" data-active="false">Aa</button>
                  <button id="search-whole-word-toggle" class="btn btn-option" title="–¶–µ–ª—ã–µ —Å–ª–æ–≤–∞" data-active="false">Ab</button>
                </div>
              </div>
            </div>

            <!-- Replace input -->
            <div class="search-group">
              <label for="replace-input">–ó–∞–º–µ–Ω–∏—Ç—å –Ω–∞:</label>
              <input type="text" id="replace-input" class="search-field" placeholder="–í–≤–µ–¥–∏—Ç–µ —Ç–µ–∫—Å—Ç –¥–ª—è –∑–∞–º–µ–Ω—ã..." />
            </div>

            <!-- Search controls -->
            <div class="search-controls">
              <div class="search-navigation">
                <button id="search-prev" class="btn btn-secondary" title="–ü—Ä–µ–¥—ã–¥—É—â–µ–µ —Å–æ–≤–ø–∞–¥–µ–Ω–∏–µ (Shift+F3)">‚Üë</button>
                <button id="search-next" class="btn btn-secondary" title="–°–ª–µ–¥—É—é—â–µ–µ —Å–æ–≤–ø–∞–¥–µ–Ω–∏–µ (F3)">‚Üì</button>
                <span id="search-results" class="search-results">0 –∏–∑ 0</span>
              </div>

              <div class="search-actions">
                <button id="replace-current" class="btn btn-primary" title="–ó–∞–º–µ–Ω–∏—Ç—å —Ç–µ–∫—É—â–µ–µ">–ó–∞–º–µ–Ω–∏—Ç—å</button>
                <button id="replace-all" class="btn btn-primary" title="–ó–∞–º–µ–Ω–∏—Ç—å –≤—Å–µ">–ó–∞–º–µ–Ω–∏—Ç—å –≤—Å–µ</button>
                <button id="replace-confirm-mode" class="btn btn-secondary" title="–†–µ–∂–∏–º –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è">–ü–æ–¥—Ç–≤–µ—Ä–¥–∏—Ç—å</button>
              </div>

              <!-- Confirm mode controls (hidden by default) -->
              <div id="confirm-mode-controls" class="confirm-mode-controls hidden">
                <div class="confirm-actions">
                  <button id="confirm-replace-yes" class="btn btn-success" title="–ó–∞–º–µ–Ω–∏—Ç—å —ç—Ç–æ —Å–æ–≤–ø–∞–¥–µ–Ω–∏–µ">–î–∞</button>
                  <button id="confirm-replace-no" class="btn btn-secondary" title="–ü—Ä–æ–ø—É—Å—Ç–∏—Ç—å —ç—Ç–æ —Å–æ–≤–ø–∞–¥–µ–Ω–∏–µ">–ù–µ—Ç</button>
                  <button id="confirm-replace-all-remaining" class="btn btn-warning" title="–ó–∞–º–µ–Ω–∏—Ç—å –≤—Å–µ –æ—Å—Ç–∞–≤—à–∏–µ—Å—è">–í—Å–µ</button>
                  <button id="confirm-replace-stop" class="btn btn-danger" title="–û—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –∑–∞–º–µ–Ω—É">–°—Ç–æ–ø</button>
                </div>
                <div class="confirm-info">
                  <span id="confirm-current-match" class="confirm-match-info"></span>
                </div>
              </div>
            </div>

            <!-- Search status -->
            <div id="search-status" class="search-status hidden"></div>

            <!-- Keyboard shortcuts help -->
            <div class="search-shortcuts">
              <details>
                <summary>–ö–ª–∞–≤–∏–∞—Ç—É—Ä–Ω—ã–µ —Å–æ—á–µ—Ç–∞–Ω–∏—è</summary>
                <div class="shortcuts-list">
                  <div><kbd>Ctrl+F</kbd> - –û—Ç–∫—Ä—ã—Ç—å –ø–æ–∏—Å–∫</div>
                  <div><kbd>Ctrl+H</kbd> - –û—Ç–∫—Ä—ã—Ç—å –ø–æ–∏—Å–∫ –∏ –∑–∞–º–µ–Ω—É</div>
                  <div><kbd>F3</kbd> / <kbd>Ctrl+G</kbd> - –°–ª–µ–¥—É—é—â–µ–µ —Å–æ–≤–ø–∞–¥–µ–Ω–∏–µ</div>
                  <div><kbd>Shift+F3</kbd> / <kbd>Ctrl+Shift+G</kbd> - –ü—Ä–µ–¥—ã–¥—É—â–µ–µ —Å–æ–≤–ø–∞–¥–µ–Ω–∏–µ</div>
                  <div><kbd>Ctrl+Enter</kbd> - –ó–∞–º–µ–Ω–∏—Ç—å –∏ –Ω–∞–π—Ç–∏ —Å–ª–µ–¥—É—é—â–µ–µ</div>
                  <div><kbd>Ctrl+Shift+Enter</kbd> - –ó–∞–º–µ–Ω–∏—Ç—å –≤—Å–µ</div>
                  <div><kbd>Alt+R</kbd> - –ü–µ—Ä–µ–∫–ª—é—á–∏—Ç—å —Ä–µ–≥—É–ª—è—Ä–Ω—ã–µ –≤—ã—Ä–∞–∂–µ–Ω–∏—è</div>
                  <div><kbd>Alt+C</kbd> - –ü–µ—Ä–µ–∫–ª—é—á–∏—Ç—å —É—á–µ—Ç —Ä–µ–≥–∏—Å—Ç—Ä–∞</div>
                  <div><kbd>Alt+W</kbd> - –ü–µ—Ä–µ–∫–ª—é—á–∏—Ç—å —Ü–µ–ª—ã–µ —Å–ª–æ–≤–∞</div>
                  <div><kbd>Escape</kbd> - –ó–∞–∫—Ä—ã—Ç—å –ø–∞–Ω–µ–ª—å</div>
                </div>
              </details>
            </div>
          </div>
        </div>
      </div>

      <!-- Main Content Area -->
      <main class="main-content">
        <!-- Mobile Tab Navigation (visible on small screens) -->
        <div class="mobile-tabs">
          <button class="tab-btn active" data-tab="editor">–†–µ–¥–∞–∫—Ç–æ—Ä</button>
          <button class="tab-btn" data-tab="preview">–ü—Ä–µ–≤—å—é</button>
        </div>

        <!-- Editor Panel -->
        <div class="editor-panel panel">
          <div class="panel-header">
            <h3>Markdown –†–µ–¥–∞–∫—Ç–æ—Ä</h3>
            <div class="panel-controls">
              <span id="char-count" class="char-count">0 —Å–∏–º–≤–æ–ª–æ–≤</span>
            </div>
          </div>
          <div id="editor-container" class="editor-container"></div>
        </div>

        <!-- Preview Panel -->
        <div class="preview-panel panel">
          <div class="panel-header">
            <h3>–ü—Ä–µ–≤—å—é</h3>
            <div class="panel-controls">
              <button id="preview-mode-toggle" class="btn btn-small" title="–ü–µ—Ä–µ–∫–ª—é—á–∏—Ç—å —Ä–µ–∂–∏–º –ø—Ä–µ–≤—å—é">üì± –ú–æ–±–∏–ª—å–Ω—ã–π –≤–∏–¥</button>
            </div>
          </div>

          <!-- Preview Content -->
          <div class="preview-content">
            <!-- Plain Text Preview (Top) -->
            <div class="preview-section plain-text-preview">
              <div class="preview-section-header">
                <h4>üìù Plain Text + –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞</h4>
              </div>
              <div id="plain-text-output" class="preview-output"></div>
            </div>

            <!-- HTML Preview (Bottom) -->
            <div class="preview-section html-preview">
              <div class="preview-section-header">
                <h4>HTML –†–µ–Ω–¥–µ—Ä</h4>
              </div>
              <div id="html-output" class="preview-output markdown-body"></div>
            </div>
          </div>
        </div>
      </main>

      <!-- Help Modal -->
      <div id="help-modal" class="modal hidden">
        <div class="modal-content">
          <div class="modal-header">
            <h3>–°–ø—Ä–∞–≤–∫–∞ –ø–æ Markdown</h3>
            <button id="close-help" class="btn btn-icon">‚úï</button>
          </div>
          <div class="modal-body">
            <div id="help-content" class="help-content">
              <!-- Help content will be loaded here -->
            </div>
          </div>
        </div>
      </div>

      <!-- Loading indicator -->
      <div id="loading" class="loading hidden">
        <div class="spinner"></div>
        <span>–ó–∞–≥—Ä—É–∑–∫–∞...</span>
      </div>
    </div>

    <!-- Scripts -->
    <script defer src="src/utils/editor-actions.js"></script>
    <script defer type="module" src="src/script/index.js"></script>
  </body>
</html>
